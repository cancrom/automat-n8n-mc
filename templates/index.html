<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Panneau de Contrôle Avancé - Bot de Stock</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f0f2f5; }
        .header { background-color: #fff; padding: 15px 30px; border-bottom: 1px solid #ddd; font-size: 1.5em; font-weight: bold; color: #333; }
        .container { max-width: 900px; margin: 2em auto; padding: 2em; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .tabs { display: flex; border-bottom: 2px solid #ccc; margin-bottom: 1.5em; }
        .tab-button { padding: 10px 20px; cursor: pointer; border: none; background-color: transparent; font-size: 1em; position: relative; color: #555; }
        .tab-button.active { font-weight: bold; color: #007bff; }
        .tab-button.active::after { content: ''; position: absolute; bottom: -2px; left: 0; right: 0; height: 2px; background-color: #007bff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        h2 { color: #333; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-top: 0;}
        label { display: block; margin-top: 1em; font-weight: 600; color: #444; }
        input[type="text"], input[type="number"], input[type="file"], select { width: 100%; padding: 10px; margin-top: 0.5em; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; background-color: #f9f9f9; }
        button { background-color: #007bff; color: white; padding: 12px 18px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; margin-top: 1.5em; transition: background-color 0.2s; }
        button:hover { background-color: #0056b3; }
        .message { padding: 1em; margin-top: 1.5em; border-radius: 5px; border-width: 1px; border-style: solid; }
        .message.success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .message.error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .results-table { width: 100%; border-collapse: collapse; margin-top: 2em; }
        .results-table th, .results-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .results-table th { background-color: #f8f9fa; font-weight: 600; }
        .status-success { color: #155724; font-weight: bold; }
        .status-error { color: #721c24; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">Panneau de Contrôle du Bot</div>
    <div class="container">
        <div class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'manualUpdate')">Mise à Jour Manuelle</button>
            <button class="tab-button" onclick="openTab(event, 'batchUpdate')">Mise à Jour par Fichier (CSV)</button>
        </div>

        <!-- Onglet pour la mise à jour manuelle -->
        <div id="manualUpdate" class="tab-content active">
            <h2>Mettre à jour un produit manuellement</h2>
            <form method="post" action="{{ url_for('index') }}">
                <div>
                    <label for="sku">SKU du Produit :</label>
                    <input type="text" id="sku" name="sku" required>
                </div>
                <div>
                    <label for="quantity">Nouvelle Quantité :</label>
                    <input type="number" id="quantity" name="quantity" required>
                </div>
                <button type="submit">Lancer la Mise à Jour</button>
            </form>
            {% if manual_result %}
                <div class="message {{ 'success' if manual_result.status == 'success' else 'error' }}">
                    <b>Statut :</b> {{ manual_result.status }} <br>
                    <b>Message :</b> {{ manual_result.message }} <br>
                    {% if manual_result.screenshot %}
                        <b>Capture :</b> <a href="{{ url_for('static', filename=manual_result.screenshot) }}" target="_blank">{{ manual_result.screenshot }}</a>
                    {% endif %}
                </div>
            {% endif %}
        </div>

        <!-- Onglet pour la mise à jour par fichier -->
        <div id="batchUpdate" class="tab-content">
            <h2>Mettre à jour plusieurs produits depuis un fichier CSV</h2>
            <form method="post" action="{{ url_for('upload_csv') }}" enctype="multipart/form-data">
                <div>
                    <label for="csv_file">Fichier CSV :</label>
                    <input type="file" id="csv_file" name="csv_file" accept=".csv" required>
                    <small>Le fichier doit contenir les en-têtes de colonnes (ex: 'sku', 'quantite').</small>
                </div>
                <button type="submit">Téléverser et Prévisualiser</button>
            </form>
        </div>

        <!-- Cette section sera remplie dynamiquement par Flask pour le mappage -->
        <div id="mappingSection">
            <!-- Le formulaire de mappage sera injecté ici -->
        </div>

        <!-- Cette section affichera les résultats du traitement en masse -->
        <div id="resultsSection">
            <!-- Le tableau des résultats sera injecté ici -->
        </div>

    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>
</body>
</html>
